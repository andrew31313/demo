{% for name, attr in interfaces.items() %}
{% if attr.comment is defined %}
# {{ attr.comment }}
{% endif %}
auto {{ name }}
iface {{ name }} inet {{ attr.method }}
{% if attr.method == "static" %}
  address {{ attr.address }}
  netmask {{ attr.netmask }}
{% if attr.gateway is defined %}
  gateway {{ attr.gateway }}
{% endif %}
{% elif attr.method == "manual" %}
  pre-up ip link set {{ name }} up
{% endif %}
{% if attr.vlan_ifaces is defined %}
{% for vname, vattr in attr.vlan_ifaces.items() %}
  post-up ip link add link {{ name }} name {{ vname }} type vlan id {{ vattr.vlan }} protocol 802.1Q || true
  post-up /gns3/bin/busybox ifup -f {{ vname }} || true
  pre-down /gns3/bin/busybox ifdown -f {{ vname }} || true
  pre-down ip link del dev {{ vname }} || true
{% endfor %}
  post-down ip link set {{ name }} down
{% for vname, vattr in attr.vlan_ifaces.items() %}
iface {{ vname }} inet {{ vattr.method }}
{% if vattr.method == "static" %}
  address {{ vattr.address }}
  netmask {{ vattr.netmask }}
{% elif vattr.method == "manual" %}
  pre-up ip link set {{ vname }} up
{% endif %}
{% endfor %}
{% endif %}

{% endfor %}
