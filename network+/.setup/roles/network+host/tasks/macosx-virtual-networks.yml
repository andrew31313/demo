---
- name: Get the list of hostonly network interfaces
  shell: "VBoxManage list hostonlyifs | grep -q 'vboxnet0'"
  changed_when: false
  failed_when: false
  register: existing_hostonlyifs
- name: Ensure kernel extensions are reloaded
  command: /Library/Application\ Support/VirtualBox/LaunchDaemons/VirtualBoxStartup.sh restart
  become: yes
- name: Ensure vboxnet0 hostonly network interface is created
  command: "{{ item }}"
  with_items:
    - VBoxManage hostonlyif create
    - VBoxManage hostonlyif ipconfig vboxnet0 --ip 192.168.56.1
    - VBoxManage dhcpserver modify --interface vboxnet0 --server-ip 192.168.56.2 --netmask 255.255.255.0 --lowerip 192.168.56.3 --upperip 192.168.56.253 --enable
  when: existing_hostonlyifs.rc != 0
