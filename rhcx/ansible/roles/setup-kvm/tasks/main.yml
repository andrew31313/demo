---
# Installing KVM 
- name: Ensure epel-release is installed
  package:
    name: epel-release
    state: latest
  become: true
- name: install kvm 
  package:
    name: "{{ item }}"
    state: present
  with_items:
     - "@virtualization-hypervisor"
     - "@virtualization-client"
     - "@virtualization-platform"
     - "@virtualization-tools"
     - qemu-kvm
  become: true
- name: Ensure qemu is installed (CentOS 7)
  package:
    name: qemu-system-x86
    state: present
  become: yes
  when: ansible_distribution_major_version == "7"
- name: Ensure qemu is installed (CentOS 8)
  package:
    name: qemu-kvm
    state: present
  become: yes
  when: ansible_distribution_major_version == "8"
- name: Ensure link to qemu-kvm using old name exists (CentOS 8)
  file:
    path: /usr/bin/qemu-system-x86_64
    src: /usr/libexec/qemu-kvm
    state: link
  become: yes
  when: ansible_distribution_major_version == "8"
