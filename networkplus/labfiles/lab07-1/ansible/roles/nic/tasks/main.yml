---
- name: Ensure network interfaces config file exists
  template:
    src: "interfaces.j2"
    dest: /etc/network/interfaces
    mode: '0644'
  become: yes
- name: Get list of default routes
  command: ip route list 0.0.0.0/0
  changed_when: false
  register: default_routes
- name: Ensure default route through bootstap server is removed
  command: ip route del 0.0.0.0/0 via 192.168.42.1
  when: "'default via 192.168.42.1 dev eth0 ' in default_routes.stdout_lines"
  become: yes
- name: Restart any interface that specifies a gateway
  shell: /gns3/bin/busybox ifdown -f {{ item.key }} && /gns3/bin/busybox ifup -f {{ item.key }}
  when: item.value.gateway is defined
  loop: "{{ interfaces | dict2items }}"
  become: yes
