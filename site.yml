---
- name: Configure controler
  hosts: control.networkplus.test
  roles:
    - role: controller
    - role: system-packages
    - role: router
  tags:
    - controller
- name: Bootstrap network interfaces
  gather_facts: false
  hosts:
    - firewalls
    - routers
  roles:
    - role: bootstrap
    - role: system-packages
    - role: nic
  tags:
    - bootstrap
# After bootstrapping, the network devices need to be cofigured from the
# outside to the inside as any device will depend on the devices between it
# and the Internet.
- name: Configure firewalls
  hosts: firewalls
  roles:
    - role: firewall
    - role: router
- name: Configure routers
  hosts: routers
  roles:
    - role: router
# Once the network is up (and we wait it a pre_task for OSPF to converge,
# we can begin configuring the hosts.
- name: Bootstrap managed hosts
  gather_facts: false
  hosts: managed_hosts
  pre_tasks:
    - name: Delay to give the newly configured OSPF routers time to converge
      wait_for_connection:
        delay: 30
        timeout: 60
  roles:
    - role: bootstrap
    - role: system-packages
- name: Configure dnsmasq servers
  hosts: dnsmasq_servers
  roles:
    - role: dnsmasq

