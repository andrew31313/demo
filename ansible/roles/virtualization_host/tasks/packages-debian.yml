---
- name: Ensure system packages are installed
  apt:
    name: "{{ item }}"
    state: present
  loop: "{{ system_packages }}"
  when:
    - system_packages is defined
    - (system_packages | length > 0)
  become: yes
- name: Ensure Internet packages are installed
  apt:
    deb: "{{ item }}"
    state: present
  loop: "{{ internet_packages }}"
  when:
    - internet_packages is defined
    - (internet_packages | length > 0)
  become: yes
- name: Fetch more recent packer
  get_url:
    dest: "{{ download_dir }}/{{ packer_override.basename }}.zip"
    url: "{{ packer_override.url }}"
    checksum: "{{ packer_override.checksum }}"
  when: packer_override is defined
- name: Unpack more recent packer
  unarchive:
    dest: "/usr/bin"
    src: "{{ download_dir }}/{{ packer_override.basename }}.zip"
    creates: "/usr/bin/packer"
    owner: "root"
    group: "root"
    mode: "0755"
    remote_src: yes
  when: packer_override is defined
  become: yes
# - name: Copy newer packer into place
#   copy:
#     dest: /usr/bin/packer
#     src: "{{ download_dir }}/{{ packer_override.basename }}/packer"
#     remote_src: yes
#     owner: "root"
#     group: "root"
#     mode: "0755"
#   when: packer_override is defined
#   become: yes
