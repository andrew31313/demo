---
# Installing KVM 
- name: Ensure epel-release is installed (CentOS)
  package:
    name: epel-release
    state: latest
  become: true
  when: ansible_distribution == 'CentOS'
- name: install kvm (CentOS)
  package:
    name: "{{ item }}"
    state: present
  with_items:
     - "@virtualization-hypervisor"
     - "@virtualization-client"
     - "@virtualization-platform"
     - "@virtualization-tools"
     - qemu-kvm
  become: true
  when: ansible_distribution == 'CentOS'
  #- name: Ensure qemu is installed (CentOS 8)
  #package:
  #  name: qemu-kvm
  #  state: present
  #become: yes
  #when: ansible_distribution == 'CentOS'
- name: Ensure link to qemu-kvm using old name exists (CentOS 8)
  file:
    path: /usr/bin/qemu-system-x86_64
    src: /usr/libexec/qemu-kvm
    state: link
  become: yes
  when: ansible_distribution == 'CentOS'
- name: Ensure virtualization packages are installed (Debian)
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - "virt-manager"
    - "python-libvirt"
  become: yes
  when: ansible_distribution == 'Debian'
