---
- name: Ensure /labfiles mount point exists
  file:
    path: /labfiles
    state: directory
    owner: root
    group: root
    mode: '0775'
  become: yes
- name: Ensure /labfiles will be remounted in the case of a reboot (KVM)
  mount:
    path: /labfiles
    src: 192.168.4.1:/home/user/demo/rhcsa/labfiles
    fstype: nfs
    opts: tcp,ro,async,noatime,_netdev
    state: present
    passno: "0"
    dump: "2"
  become: yes
  notify: reboot
  when: ansible_virtualization_type == 'kvm'
- name: Ensure labfiles.service file exists to work around systemd bug (VirtualBox)
  copy:
    dest: /etc/systemd/system/labfiles.service
    src: labfiles.service
    owner: root
    group: root
    mode: "0755"
  become: yes
  when: ansible_virtualization_type == 'virtualbox'
- name: Ensure labfiles.service is enabled (VirtualBox)
  systemd:
    name: labfiles
    enabled: yes
    state: started
  become: yes
  when: ansible_virtualization_type == 'virtualbox'
