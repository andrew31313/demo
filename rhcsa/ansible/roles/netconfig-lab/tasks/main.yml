---
- name: Ensure /etc/hosts includes all hosts prior to configuring DNS
  lineinfile:
    path: /etc/hosts
    line: "{{ item }}"
  become: yes
  with_items:
    - "192.168.4.200 labipa.example.com ipa"
    - "192.168.4.210 server1.example.com server1"
    - "192.168.4.220 server2.example.com server2"
    - "192.168.4.230 testnetinstall.example.com testnetinstall"
- name: Ensure the connection for the lab network exists
  nmcli:
    conn_name: "{{ host_lab_net_conn_name }}"
    type: "{{ lab_net_type | default(omit) }}"
    ifname: "{{ host_lab_net_iface | default(omit) }}"
    autoconnect: "{{ lab_net_autoconnect | default(omit) }}"
    dns4: "{{ lab_net_ipv4_dns | default(omit) }}"
    dns4_ignore_auto: "{{ lab_net_ipv4_ignore_auto_dns | default(omit) }}"
    gw4: "{{ lab_net_ipv4_gateway | default(omit) }}"
    ip4: "{{ host_lab_net_ipv4_addresses | default(omit) }}"
    method4: "{{ lab_net_ipv4_method | default(omit) }}"
    method6: "{{ lab_net_ipv6_method | default(omit) }}"
    never_default4: "{{ lab_net_ipv4_never_default | default(omit) }}"
    zone: "{{ lab_net_zone | default(omit) }}"
    state: present
  become: yes
  notify: new_lab_connection
